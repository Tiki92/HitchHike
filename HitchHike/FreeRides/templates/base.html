<!DOCTYPE html>
<html>
<head>
	{% load staticfiles %}

	{% load leaflet_tags %}
	{% leaflet_js %}
	{% leaflet_css %}


	<script type="text/javascript" src="{% static '/cluster/dist/leaflet.markercluster-src.js' %}"></script>
	<script type="text/javascript" src="{% static '/dist/leaflet.ajax.js' %}"></script>
	<script type="text/javascript" src="{% static '/routing/leaflet-routing-machine.js' %}"></script>
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
	<link rel="stylesheet" type="text/css" href="{% static 'routing/leaflet-routing-machine.css' %}">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
	<link rel="stylesheet" href="{% static 'cluster/dist/MarkerCluster.Default.css' %}">
    <link rel="stylesheet" href="{% static 'cluster/dist/MarkerCluster.css' %}">



	<meta charset="UTF-8">

	<title>
		{% block head_title %}
		{% endblock %}
	</title>

		{% block extra_head %}
		{% endblock %}
</head>

<body>



	<div>
		{% block body %}
      {% if messages %}
		<div>
			<strong>Messages:</strong>
			<ul>
				{% for message in messages %}
				<li>{{message}}</li>
				{% endfor %}
			</ul>
		</div>
		{% endif %}
		<div>
			<nav class="navbar navbar-expand-lg navbar-light bg-light">
				<a class="navbar-brand" href="#">HitchHike</a>
				<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
				<div class="collapse navbar-collapse" id="navbarNavDropdown">
					<ul class="navbar-nav">
						<li class="nav-item active">
							<a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="#">Features</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="#">Pricing</a>
						</li>
						{% if user.is_authenticated %}
						<li class="nav-item">
							<li class="nav-item">
								<a class="nav-link" href="{% url 'account_email' %}">Change E-mail</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="{% url 'account_logout' %}">Sign Out</a>
							</li>
							{% else %}
							<li class="nav-item">
								<a class="nav-link" href="{% url 'account_login' %}">Sign In</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="{% url 'account_signup' %}">Sign Up</a>
							</li>

							{% endif %}
							<li class="nav-item dropdown">
								<a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Dropdown link
            </a>
								<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
									<a class="dropdown-item" href="#">Action</a>
									<a class="dropdown-item" href="#">Another action</a>
									<a class="dropdown-item" href="#">Something else here</a>
								</div>
							</li>
					</ul>
				</div>
			</nav>
		</div>
		<div>
          {% block content %}
					{% leaflet_map "map" callback="window.map_init_basic" %}
          {% endblock %}

          {% endblock %}
          {% block extra_body %}
          {% endblock %}
		</div>

	</div>
</body>

{% block script %}

{% endblock %}

<script type="text/javascript">

function map_init_basic (map, options) {

		var dataset = new L.geoJson.ajax("{% url 'loc_data' %}",{

		});

        console.log({{ dec_loc|safe }});
		var markers = L.markerClusterGroup();
		for (var i = 0; i < {{ dec_loc|safe }}['features'].length; i++) {

			var a = {{ dec_loc|safe }}['features'][i]['geometry']['coordinates'];
			var title = {{ dec_loc|safe }}['features'][i]['properties']['location_name'];
			var marker = L.marker(new L.LatLng(a[1], a[0]), { title: title });
			marker.bindPopup(title);
			markers.addLayer(marker);
		}

		map.addLayer(markers);
		//dataset.addTo(map);

}
</script>

</html>
